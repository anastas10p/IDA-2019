---
title: "Case_Study_Group_04"
output: html_document
---

```{r setup_8, include=FALSE}
knitr::opts_chunk$set(message = TRUE)
```

# Packages
Include the `shiny`, `tidyverse` and `readr` packages
```{r}
if(!require(shiny)){
  install.packages("shiny")
}
library(shiny)

if(!require(dplyr)){
  install.packages("dplyr")
}
library(dplyr)

if( !require(tidyverse)){
  install.packages("tidyverse")
}
library(tidyverse)

if( !require(readr)){
  install.packages("readr")
}
library(readr)
if(!require(ggplot2)){
  install.packages("ggplot2")
}
library(ggplot2)
1

allData<-load("allComponents.RData") 
if(is.data.frame(allComponents)){
   names(allComponents)
}
allData
```

```{r}

#Filter Data


```{r}


```
RelativeFails_allComponents <- allComponents %>% #not from all components, this must change
  mutate(helferspalte=1)%>%
 group_by(id,factory,production_date,helferspalte)%>%
  summarise(Total=sum(faulty,na.rm=TRUE),relRatioinProzent= (Total/sum(helferspalte))*100)%>%
  select(-(helferspalte))%>% #remove helperspalte
  arrange(production_date)
RelativeFails_allComponents

unique(RelativeFails_allComponents$id)
```

#nach Jahren in Tabellen packen

#Test der Visualisierung
```{r}
testdataset<-filter(RelativeFails_K7,factory_number==1132)
testdataset
#das Jahr auswählen --> wird ja eigentlich schon vorher gefiltert
#nach Komponente groupen; Komponente wird über nen Knop ausgewählt
ggplot(RelativeFails_K7,aes(production_date,relRatioinProzent,group=factory_number))+
  geom_line(aes(color=factory_number))

```

```{r}
#

ui <- fluidPage(
  titlePanel("Case Study Gruppe 4"),
  sidebarLayout(
    #selection of year and component
    sidebarPanel(radioButtons(inputId = "selectedYear", "Wählen Sie ein Analysejahr aus: ", choices = list("2008", "2009", "2010", "2011", "2012", "2013","2014","2015","2016")),radioButtons(inputId = "selectedComponent", "Wählen Sie eine Komponente: ", choices = list("K1BE1", "K1BE2", "K1DI1" ,"K2LE2", "K2ST1", "K2ST2" ,"K3SG1", "K4" ,"K5" ,   "K6" ,   "K7" ,   "K3AG1"
,"K3AG2", "K3SG2"))),
    
  mainPanel(
    plotOutput(outputId = "plot")
  )
  )
)

#writing server function
server <- function(input, output) {
  output$plot <- renderPlot({

      #filter the dataset for the selected year and component (DAS MUSS noch geändert werden; ist viel zu langsam)
      filterperyear<-filter(RelativeFails_allComponents,grepl(input$selectedYear,production_date)==TRUE&grepl(input$selectedComponent,id)==TRUE)
     
      
      #brauche ich um die X Achse zu skalieren; noch unschön
      if(input$selectedYear == 2008){
        min=as.Date('2008-01-01')
       # min=as.Date(sprintf("%s-01-01"),toString(input$selectedYear))
        max=as.Date('2008-12-31')
      }else if(input$selectedYear == 2009){
        min=as.Date('2009-01-01')
        max=as.Date('2009-12-31')
      }else if(input$selectedYear == 2010){
        min=as.Date('2010-01-01')
        max=as.Date('2010-12-31')
      }else if(input$selectedYear == 2011){
        min=as.Date('2011-01-01')
        max=as.Date('2011-12-31')
      }else if(input$selectedYear == 2012){
        min=as.Date('2012-01-01')
        max=as.Date('2012-12-31')
      }else if(input$selectedYear == 2013){
        min=as.Date('2013-01-01')
        max=as.Date('2013-12-31')
      }else if(input$selectedYear == 2014){
        min=as.Date('2014-01-01')
        max=as.Date('2014-12-31')
      }else if(input$selectedYear == 2015){
        min=as.Date('2015-01-01')
        max=as.Date('2015-12-31')
      }else if(input$selectedYear == 2016){
        min=as.Date('2016-01-01')
        max=as.Date('2016-12-31')
     
      # Datum verbessern
      
      
        gesamt<-filterperyear%>%
          group_by(production_date)%>%
          arrange(production_date)#arrange eigentlich unnötig???
      
        newdata<-filterperyear
         
        ggplot()+
        geom_line(data=newdata,aes(production_date,Total,colour=factory))+
        #es fehlt noch die Summe
        #xlab="X-axis label", ylab="y-axix label",
        
        coord_cartesian( xlim=c(min,max))+ #scale x axis from January until December
        labs(title = "absolute failure figures of the component", x = " weeks", y = " failure rate") #not yet weeks must change


  }    

  )
 
}

shinyApp(ui, server)
```
